{"cells":[{"source":"<a href=\"https://www.kaggle.com/code/vilquer/elt-579-118781-problema-da-semana-2?scriptVersionId=196873671\" target=\"_blank\"><img align=\"left\" alt=\"Kaggle\" title=\"Open in Kaggle\" src=\"https://kaggle.com/static/images/open-in-kaggle.svg\"></a>","metadata":{},"cell_type":"markdown"},{"cell_type":"markdown","id":"b0c74c18","metadata":{"papermill":{"duration":0.004534,"end_time":"2024-09-16T11:22:47.909528","exception":false,"start_time":"2024-09-16T11:22:47.904994","status":"completed"},"tags":[]},"source":["## Importações e configurações"]},{"cell_type":"code","execution_count":1,"id":"eb367254","metadata":{"execution":{"iopub.execute_input":"2024-09-16T11:22:47.920042Z","iopub.status.busy":"2024-09-16T11:22:47.919486Z","iopub.status.idle":"2024-09-16T11:22:50.315009Z","shell.execute_reply":"2024-09-16T11:22:50.313786Z"},"papermill":{"duration":2.403984,"end_time":"2024-09-16T11:22:50.317852","exception":false,"start_time":"2024-09-16T11:22:47.913868","status":"completed"},"tags":[]},"outputs":[],"source":["import pandas as pd\n","import numpy as np\n","import matplotlib.pyplot as plt\n","from tqdm import tqdm\n","\n","from sklearn.compose import ColumnTransformer\n","from sklearn.feature_selection import RFE\n","from sklearn.preprocessing import  StandardScaler, MinMaxScaler, RobustScaler\n","from sklearn.decomposition import PCA\n","from sklearn.pipeline import Pipeline\n","from sklearn.model_selection import train_test_split, cross_val_score, cross_validate, ShuffleSplit, GridSearchCV, RandomizedSearchCV\n","from sklearn.linear_model import LinearRegression\n","from sklearn.ensemble import GradientBoostingRegressor, RandomForestRegressor\n","from sklearn.neighbors import KNeighborsRegressor\n","from sklearn.tree import DecisionTreeRegressor\n","from xgboost import XGBRegressor\n","from sklearn.metrics import make_scorer, mean_squared_error, mean_absolute_error, r2_score\n","\n","\n","import warnings\n","warnings.filterwarnings('ignore')\n","warnings.simplefilter('ignore')\n","\n","from IPython.display import display, HTML\n","\n","caminho_dos_dados = '/kaggle/input/dataset-problema2/dataset_problema2.csv'"]},{"cell_type":"markdown","id":"63b0695c","metadata":{"papermill":{"duration":0.003828,"end_time":"2024-09-16T11:22:50.325859","exception":false,"start_time":"2024-09-16T11:22:50.322031","status":"completed"},"tags":[]},"source":["## Modelo entregue como base"]},{"cell_type":"code","execution_count":2,"id":"c4d2bd73","metadata":{"execution":{"iopub.execute_input":"2024-09-16T11:22:50.33596Z","iopub.status.busy":"2024-09-16T11:22:50.335374Z","iopub.status.idle":"2024-09-16T11:22:52.240419Z","shell.execute_reply":"2024-09-16T11:22:52.239227Z"},"papermill":{"duration":1.913256,"end_time":"2024-09-16T11:22:52.243083","exception":false,"start_time":"2024-09-16T11:22:50.329827","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["Importar o dataset...\n","Separar dados de treinamento e dados de teste...\n","Padronizar os dados...\n","seleção de features...\n","Médias dos Scores\n","-0.06445199150879911\n","0.09396486029263365\n","0.6727804225015419\n","0.726672062129073\n","0.8223245283790293\n","0.8233753596097613\n","0.8202942847768545\n","0.8160171069363862\n","0.8642534971610811\n","0.8655536026351045\n","0.8592050402770244\n","0.8626245070274547\n","0.8617649200609072\n","0.8568329558908353\n","0.85515608058196\n","0.8539354093341999\n","0.8498948606437716\n","0.8484410541107404\n","0.843880605104897\n","0.8417215821030458\n","Gráfico...\n"]},{"data":{"image/png":"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","text/plain":["<Figure size 640x480 with 1 Axes>"]},"metadata":{},"output_type":"display_data"},{"name":"stdout","output_type":"stream","text":["Seleção de features - Final...\n","Features Index(['NDVI_d28', 'SAVI_d28', 'GNDVI_d28', 'MCARI1_d28', 'SR_d28', 'NDVI_d01',\n","       'SAVI_d01', 'GNDVI_d01', 'MCARI1_d01', 'SR_d01', 'NDVI_d04', 'SAVI_d04',\n","       'GNDVI_d04', 'MCARI1_d04', 'SR_d04', 'NDVI_d08', 'SAVI_d08',\n","       'GNDVI_d08', 'MCARI1_d08', 'SR_d08'],\n","      dtype='object')\n","Médias dos Scores\n","0.8655536026351045\n","Features selecionadas Index(['NDVI_d28', 'SAVI_d28', 'NDVI_d01', 'SAVI_d01', 'NDVI_d04', 'SAVI_d04',\n","       'NDVI_d08', 'SAVI_d08', 'GNDVI_d08', 'SR_d08'],\n","      dtype='object')\n","validação cruzada\n","0.8655536026351045\n","Modelo final - Regressão linear multipla...\n","Testar nos dados de teste...\n","\n","Resultados em teste:\n","r2 0.887634277870405\n","rmse 7.539476072278346\n","mae 6.344066348950323\n"]}],"source":["# -*- coding: utf-8 -*-\n","\"\"\"\n","\n","@author: sarvio valente\n","\n","\"\"\"\n","\n","import pandas as pd\n","import numpy as np\n","import matplotlib.pyplot as plt\n","\n","print('Importar o dataset...')\n","\n","df = pd.read_csv(caminho_dos_dados)\n","\n","X = df.drop(['id', 'Severidade'], axis = 1)\n","y = df['Severidade']\n","\n","print('Separar dados de treinamento e dados de teste...')\n","\n","from sklearn.model_selection import train_test_split\n","\n","X_train, X_test, y_train, y_test = train_test_split(X, y, test_size = 0.2, random_state = 0)\n","\n","print('Padronizar os dados...')\n","\n","from sklearn.preprocessing import StandardScaler\n","\n","scaler = StandardScaler() #media 0 e desvio padrão 1\n","\n","X_train_sc = scaler.fit_transform(X_train)\n","\n","X_test_sc = scaler.transform(X_test)\n","\n","X_train_sc = pd.DataFrame(X_train_sc)\n","X_train_sc.columns = X_train.columns\n","\n","X_test_sc = pd.DataFrame(X_test_sc)\n","X_test_sc.columns = X_train.columns\n","\n","\n","print('seleção de features...')\n","from sklearn.feature_selection import RFE\n","from sklearn.linear_model import LinearRegression\n","from sklearn.model_selection import cross_val_score\n","\n","max_f = 20\n","\n","lista_score = list()\n","print('Médias dos Scores')\n","for i in range(1, max_f +1):\n","\n","    modelo_linear = LinearRegression()\n","    selector = RFE(modelo_linear, n_features_to_select = i, step = 1)\n","    selector = selector.fit(X_train_sc, y_train)\n","    mask = selector.support_\n","    features = X_train_sc.columns\n","    sel_features = features[mask]\n","    X_sel = X_train_sc[sel_features]\n","    score = cross_val_score(modelo_linear, X_sel, y_train, cv = 10, scoring = 'r2')\n","    print(np.mean(score))\n","    lista_score.append(np.mean(score))\n","\n","print('Gráfico...')\n","\n","import matplotlib.pyplot as plt\n","\n","plt.plot(lista_score)\n","\n","plt.show()\n","\n","print('Seleção de features - Final...')\n","from sklearn.feature_selection import RFE\n","from sklearn.linear_model import LinearRegression\n","from sklearn.model_selection import cross_val_score\n","\n","\n","modelo_linear = LinearRegression()\n","selector = RFE(modelo_linear, n_features_to_select = 10, step = 1)\n","selector = selector.fit(X_train_sc, y_train)\n","mask = selector.support_\n","features = X_train_sc.columns\n","print('Features', features)\n","sel_features = features[mask]\n","X_sel = X_train_sc[sel_features]\n","score = cross_val_score(modelo_linear, X_sel, y_train, cv = 10, scoring = 'r2')\n","\n","print('Médias dos Scores')\n","print(np.mean(score))\n","print('Features selecionadas', sel_features)\n","\n","print('validação cruzada')\n","\n","from sklearn.linear_model import LinearRegression\n","from sklearn.model_selection import cross_val_score\n","\n","modelo_linear = LinearRegression()\n","\n","score = cross_val_score(modelo_linear, X_sel, y_train, cv = 10, scoring = 'r2')\n","\n","print(np.mean(score))\n","\n","\n","print('Modelo final - Regressão linear multipla...')\n","\n","modelo_linear = LinearRegression()\n","\n","modelo_linear.fit(X_sel, y_train)\n","\n","\n","print('Testar nos dados de teste...')\n","\n","from sklearn.metrics import mean_squared_error\n","from sklearn.metrics import mean_absolute_error\n","\n","y_pred = modelo_linear.predict(X_test_sc[sel_features])\n","\n","r2 = modelo_linear.score(X_test_sc[sel_features], y_test)\n","\n","rmse = (mean_squared_error(y_test, y_pred)**0.5)\n","\n","mae = mean_absolute_error(y_test, y_pred)\n","\n","print('')\n","\n","print('Resultados em teste:')\n","print('r2', r2)\n","print('rmse', rmse)\n","print('mae', mae)\n"]},{"cell_type":"markdown","id":"20c6ba26","metadata":{"papermill":{"duration":0.004957,"end_time":"2024-09-16T11:22:52.253448","exception":false,"start_time":"2024-09-16T11:22:52.248491","status":"completed"},"tags":[]},"source":["## Modeo desafiane"]},{"cell_type":"code","execution_count":3,"id":"5878dee9","metadata":{"execution":{"iopub.execute_input":"2024-09-16T11:22:52.266397Z","iopub.status.busy":"2024-09-16T11:22:52.265977Z","iopub.status.idle":"2024-09-16T11:35:08.007358Z","shell.execute_reply":"2024-09-16T11:35:08.00609Z"},"papermill":{"duration":735.751487,"end_time":"2024-09-16T11:35:08.01018","exception":false,"start_time":"2024-09-16T11:22:52.258693","status":"completed"},"tags":[]},"outputs":[{"name":"stderr","output_type":"stream","text":["100%|██████████| 6/6 [12:15<00:00, 122.59s/it]\n"]},{"data":{"text/html":["<style type=\"text/css\">\n","#T_3db60_row0_col3, #T_3db60_row1_col1, #T_3db60_row2_col3, #T_3db60_row3_col3, #T_3db60_row4_col3 {\n","  color: white;\n","  background-color: gray;\n","}\n","</style>\n","<table id=\"T_3db60\">\n","  <thead>\n","    <tr>\n","      <th id=\"T_3db60_level0_col0\" class=\"col_heading level0 col0\" >score</th>\n","      <th id=\"T_3db60_level0_col1\" class=\"col_heading level0 col1\" >Decision Tree Regressor</th>\n","      <th id=\"T_3db60_level0_col2\" class=\"col_heading level0 col2\" >Gradient Boosting Regressor</th>\n","      <th id=\"T_3db60_level0_col3\" class=\"col_heading level0 col3\" >KNN Regressor</th>\n","      <th id=\"T_3db60_level0_col4\" class=\"col_heading level0 col4\" >Linear Regression</th>\n","      <th id=\"T_3db60_level0_col5\" class=\"col_heading level0 col5\" >Random Forest Regressor</th>\n","      <th id=\"T_3db60_level0_col6\" class=\"col_heading level0 col6\" >XGBoost Regressor</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <td id=\"T_3db60_row0_col0\" class=\"data row0 col0\" >fit_time</td>\n","      <td id=\"T_3db60_row0_col1\" class=\"data row0 col1\" >0.033 ± 0.005</td>\n","      <td id=\"T_3db60_row0_col2\" class=\"data row0 col2\" >0.126 ± 0.018</td>\n","      <td id=\"T_3db60_row0_col3\" class=\"data row0 col3\" >0.010 ± 0.001</td>\n","      <td id=\"T_3db60_row0_col4\" class=\"data row0 col4\" >0.034 ± 0.005</td>\n","      <td id=\"T_3db60_row0_col5\" class=\"data row0 col5\" >1.405 ± 0.213</td>\n","      <td id=\"T_3db60_row0_col6\" class=\"data row0 col6\" >0.121 ± 0.020</td>\n","    </tr>\n","    <tr>\n","      <td id=\"T_3db60_row1_col0\" class=\"data row1 col0\" >score_time</td>\n","      <td id=\"T_3db60_row1_col1\" class=\"data row1 col1\" >0.004 ± 0.001</td>\n","      <td id=\"T_3db60_row1_col2\" class=\"data row1 col2\" >0.005 ± 0.001</td>\n","      <td id=\"T_3db60_row1_col3\" class=\"data row1 col3\" >0.005 ± 0.001</td>\n","      <td id=\"T_3db60_row1_col4\" class=\"data row1 col4\" >0.005 ± 0.001</td>\n","      <td id=\"T_3db60_row1_col5\" class=\"data row1 col5\" >0.026 ± 0.004</td>\n","      <td id=\"T_3db60_row1_col6\" class=\"data row1 col6\" >0.006 ± 0.001</td>\n","    </tr>\n","    <tr>\n","      <td id=\"T_3db60_row2_col0\" class=\"data row2 col0\" >test_RMSE</td>\n","      <td id=\"T_3db60_row2_col1\" class=\"data row2 col1\" >-9.256 ± 1.116</td>\n","      <td id=\"T_3db60_row2_col2\" class=\"data row2 col2\" >-8.318 ± 3.119</td>\n","      <td id=\"T_3db60_row2_col3\" class=\"data row2 col3\" >-6.041 ± 2.038</td>\n","      <td id=\"T_3db60_row2_col4\" class=\"data row2 col4\" >-7.283 ± 1.522</td>\n","      <td id=\"T_3db60_row2_col5\" class=\"data row2 col5\" >-7.447 ± 2.453</td>\n","      <td id=\"T_3db60_row2_col6\" class=\"data row2 col6\" >-7.861 ± 1.569</td>\n","    </tr>\n","    <tr>\n","      <td id=\"T_3db60_row3_col0\" class=\"data row3 col0\" >test_MAE</td>\n","      <td id=\"T_3db60_row3_col1\" class=\"data row3 col1\" >-6.501 ± 0.669</td>\n","      <td id=\"T_3db60_row3_col2\" class=\"data row3 col2\" >-5.685 ± 1.865</td>\n","      <td id=\"T_3db60_row3_col3\" class=\"data row3 col3\" >-4.464 ± 1.379</td>\n","      <td id=\"T_3db60_row3_col4\" class=\"data row3 col4\" >-5.444 ± 1.018</td>\n","      <td id=\"T_3db60_row3_col5\" class=\"data row3 col5\" >-5.398 ± 1.567</td>\n","      <td id=\"T_3db60_row3_col6\" class=\"data row3 col6\" >-5.349 ± 0.851</td>\n","    </tr>\n","    <tr>\n","      <td id=\"T_3db60_row4_col0\" class=\"data row4 col0\" >test_R2</td>\n","      <td id=\"T_3db60_row4_col1\" class=\"data row4 col1\" >0.826 ± 0.041</td>\n","      <td id=\"T_3db60_row4_col2\" class=\"data row4 col2\" >0.836 ± 0.125</td>\n","      <td id=\"T_3db60_row4_col3\" class=\"data row4 col3\" >0.917 ± 0.066</td>\n","      <td id=\"T_3db60_row4_col4\" class=\"data row4 col4\" >0.889 ± 0.052</td>\n","      <td id=\"T_3db60_row4_col5\" class=\"data row4 col5\" >0.874 ± 0.089</td>\n","      <td id=\"T_3db60_row4_col6\" class=\"data row4 col6\" >0.867 ± 0.062</td>\n","    </tr>\n","  </tbody>\n","</table>\n"],"text/plain":["<pandas.io.formats.style.Styler at 0x7a9729f5a8c0>"]},"metadata":{},"output_type":"display_data"},{"data":{"text/html":["<h3> O melhor modelo é o : <span style=\"color:red\">KNN Regressor</span></h3>"],"text/plain":["<IPython.core.display.HTML object>"]},"metadata":{},"output_type":"display_data"},{"data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>1</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>Model</th>\n","      <td>KNN Regressor</td>\n","    </tr>\n","    <tr>\n","      <th>Best n_features_to_select (RFE)</th>\n","      <td>20</td>\n","    </tr>\n","    <tr>\n","      <th>preprocessing__scaler</th>\n","      <td>StandardScaler()</td>\n","    </tr>\n","    <tr>\n","      <th>model__n_neighbors</th>\n","      <td>5.0</td>\n","    </tr>\n","    <tr>\n","      <th>model__weights</th>\n","      <td>distance</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>"],"text/plain":["                                                1\n","Model                               KNN Regressor\n","Best n_features_to_select (RFE)                20\n","preprocessing__scaler            StandardScaler()\n","model__n_neighbors                            5.0\n","model__weights                           distance"]},"metadata":{},"output_type":"display_data"}],"source":["# Regressor base para RFE\n","base_regressor = LinearRegression()\n","\n","# Preprocessador com RFE e possibilidade de diferentes Scalers\n","preprocessor = Pipeline(steps=[\n","    (\"scaler\", StandardScaler()),  # Placeholder; será ajustado pelo GridSearchCV\n","    (\"rfe\", RFE(estimator=base_regressor))  # RFE ; será ajustado pelo GridSearchCV\n","])\n","\n","# Modelos de regressão e parâmetros para grid search\n","models = {\n","    'Linear Regression': LinearRegression(),\n","    'KNN Regressor': KNeighborsRegressor(),\n","    'Decision Tree Regressor': DecisionTreeRegressor(random_state=0),\n","    'Random Forest Regressor': RandomForestRegressor(random_state=0),\n","    'Gradient Boosting Regressor': GradientBoostingRegressor(random_state=0),\n","    'XGBoost Regressor': XGBRegressor(random_state=0)\n","}\n","\n","# Parâmetros de Grid Search para cada modelo\n","params = {\n","    'Linear Regression': {\n","        'model__fit_intercept': [True, False],\n","        'preprocessing__scaler': [StandardScaler(), MinMaxScaler(), RobustScaler()],  # Diferentes escaladores\n","        'preprocessing__rfe__n_features_to_select': list(range(1, len(X_train.columns) + 1))  # Otimização de n_features_to_select\n","    },\n","    'KNN Regressor': {\n","        'model__n_neighbors': [5, 10, 15],\n","        'model__weights': ['uniform', 'distance'],\n","        'preprocessing__scaler': [StandardScaler(), MinMaxScaler(), RobustScaler()],\n","        'preprocessing__rfe__n_features_to_select': list(range(1, len(X_train.columns) + 1))\n","    },\n","    'Decision Tree Regressor': {\n","        'model__max_depth': [None, 10, 20],\n","        'model__criterion': ['squared_error', 'friedman_mse', 'absolute_error'],\n","        'preprocessing__scaler': [StandardScaler(), MinMaxScaler(), RobustScaler()],\n","        'preprocessing__rfe__n_features_to_select': list(range(1, len(X_train.columns) + 1))\n","    },\n","    'Random Forest Regressor': {\n","        'model__n_estimators': [100, 200, 300],\n","        'model__criterion': ['squared_error', 'absolute_error'],\n","        'preprocessing__scaler': [StandardScaler(), MinMaxScaler(), RobustScaler()],\n","        'preprocessing__rfe__n_features_to_select': list(range(1, len(X_train.columns) + 1))\n","    },\n","    'Gradient Boosting Regressor': {\n","        'model__n_estimators': [100, 200],\n","        'model__learning_rate': [0.01, 0.1, 0.2],\n","        'preprocessing__scaler': [StandardScaler(), MinMaxScaler(), RobustScaler()],\n","        'preprocessing__rfe__n_features_to_select': list(range(1, len(X_train.columns) + 1))\n","    },\n","    'XGBoost Regressor': {\n","        'model__max_depth': [3, 5, 7],\n","        'model__gamma': [0, 0.5, 1],\n","        'model__n_estimators': [100, 200],\n","        'preprocessing__scaler': [StandardScaler(), MinMaxScaler(), RobustScaler()],\n","        'preprocessing__rfe__n_features_to_select': list(range(1, len(X_train.columns) + 1))\n","    }\n","}\n","\n","# Resultados\n","results = {}\n","n_splits = 5  # Número de divisões para cross-validation\n","best_params = {}  # Para armazenar os melhores hiperparâmetros de cada modelo\n","\n","# Definir custom scorers\n","def rmse(y_true, y_pred):\n","    return mean_squared_error(y_true, y_pred) ** 0.5\n","\n","def mae(y_true, y_pred):\n","    return mean_absolute_error(y_true, y_pred)\n","\n","# Custom scoring\n","scoring = {\n","    'RMSE': make_scorer(rmse, greater_is_better=False),\n","    'MAE': make_scorer(mae, greater_is_better=False),\n","    'R2': make_scorer(r2_score)\n","}\n","\n","n_splits = 5  # Número de divisões para cross-validation\n","# Divisões de dados aleatórios fixas\n","cv = ShuffleSplit(n_splits=n_splits, test_size=0.2, random_state=0)  \n","\n","# Cross-validation com GridSearchCV para cada regressor\n","for model_name, model in tqdm(models.items()):\n","    # Grid de parâmetros\n","    param_grid = params.get(model_name, {})\n","    \n","    # Pipeline de abordagem\n","    approach = Pipeline([\n","        ('preprocessing', preprocessor),\n","        ('model', model)\n","    ])\n","    \n","    # GridSearchCV\n","    gs = GridSearchCV(\n","        estimator=approach,\n","        param_grid=param_grid,\n","        scoring='r2',  # Alterado para usar R2 como métrica de pontuação\n","        cv=cv,\n","        n_jobs=-1\n","    )\n","    \n","    # Ajustar o modelo\n","    gs.fit(X_train, y_train)\n","    \n","    # Recuperar os melhores parâmetros e a melhor pontuação\n","    best_params[model_name] = gs.best_params_\n","    \n","    # Cross-validation para avaliar o melhor modelo\n","    scores = cross_validate(\n","        estimator=gs.best_estimator_,\n","        X=X_train,\n","        y=y_train,\n","        cv=cv,\n","        n_jobs=-1,\n","        verbose=0,\n","        scoring=scoring\n","    )\n","    \n","    scores['model'] = [model_name] * n_splits\n","    if not results:\n","        results = scores\n","    else:\n","        for key in results:\n","            results[key] = list(results[key])\n","            results[key].extend(scores[key])\n","\n","# Inicializando uma lista para armazenar os resultados\n","best_params_list = []\n","\n","# Iterando pelos melhores parâmetros de cada modelo e organizando em um DataFrame\n","for model_name in best_params:\n","    model_best_params = best_params[model_name].copy()  # Faz uma cópia para evitar alterações indesejadas\n","    model_best_params['Model'] = model_name  # Adiciona o nome do modelo\n","    # Verifica se 'preprocessing__rfe__n_features_to_select' está nos melhores parâmetros\n","    if 'preprocessing__rfe__n_features_to_select' in model_best_params:\n","        model_best_params['Best n_features_to_select (RFE)'] = model_best_params.pop('preprocessing__rfe__n_features_to_select')\n","    else:\n","        model_best_params['Best n_features_to_select (RFE)'] = None  # Caso não haja seleção de features, coloca None\n","    \n","    # Adiciona o dicionário à lista\n","    best_params_list.append(model_best_params)\n","\n","# Convertendo a lista de dicionários em um DataFrame\n","df_best_params = pd.DataFrame(best_params_list)\n","\n","# Reorganizando colunas para melhor visualização\n","df_best_params = df_best_params[['Model', 'Best n_features_to_select (RFE)'] + [col for col in df_best_params.columns if col not in ['Model', 'Best n_features_to_select (RFE)']]]\n","\n","# Converter resultados para DataFrame e agregar\n","resultados = pd.DataFrame(results).groupby('model').agg([lambda x: f\"{np.mean(x):.3f} ± {np.std(x):.3f}\"]).transpose().reset_index()\n","resultados = resultados.rename(columns={\"level_0\": \"score\"}).drop(columns=\"level_1\")\n","\n","# Funções para destacar os melhores resultados\n","def highlight_max(s, props=''):\n","    values = [float(value.split()[0]) for value in s.values[1:]]\n","    result = [''] * len(s.values)\n","    if s.values[0].endswith('time'):\n","        result[np.argmin(values) + 1] = props\n","    else:\n","        result[np.argmax(values) + 1] = props\n","    return result\n","\n","def get_winner(s):\n","    metric = s.values[0]\n","    values = [float(value.split()[0]) for value in s.values[1:]]\n","    models = resultados.columns[1:]\n","    \n","    if s.values[0].endswith('time'):\n","        return models[np.argmin(values)]\n","    else:\n","        return models[np.argmax(values)]\n","\n","# Determinar o modelo vencedor\n","time_scores = ['fit_time', 'score_time']\n","winner = resultados.query('score not in @time_scores').apply(get_winner, axis=1).value_counts().index[0]\n","resultados.columns.name = ''\n","\n","# Aplicar estilo e exibir resultados\n","resultados = (\n","    resultados\n","    .style\n","    .hide(axis='index')\n","    .apply(highlight_max, props='color:white;background-color:gray', axis=1)\n",")\n","\n","display(resultados)\n","display(HTML(f'<h3> O melhor modelo é o : <span style=\"color:red\">{winner}</span></h3>'))\n","\n","display(df_best_params.loc[df_best_params['Model'] == winner].dropna(axis=1).T)\n","\n"]},{"cell_type":"markdown","id":"ebb16f8d","metadata":{"papermill":{"duration":0.006657,"end_time":"2024-09-16T11:35:08.023826","exception":false,"start_time":"2024-09-16T11:35:08.017169","status":"completed"},"tags":[]},"source":["## Modelo Final"]},{"cell_type":"code","execution_count":4,"id":"1cfd0733","metadata":{"execution":{"iopub.execute_input":"2024-09-16T11:35:08.039696Z","iopub.status.busy":"2024-09-16T11:35:08.039137Z","iopub.status.idle":"2024-09-16T11:35:08.1112Z","shell.execute_reply":"2024-09-16T11:35:08.106392Z"},"papermill":{"duration":0.083774,"end_time":"2024-09-16T11:35:08.114387","exception":false,"start_time":"2024-09-16T11:35:08.030613","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["r2 0.9054594871570645\n","rmse 6.915653423625461\n","mae 5.5860499237985675\n"]}],"source":["final_pipeline = Pipeline([\n","    ('preprocessing', Pipeline([\n","        ('scaler', StandardScaler()),  # Melhor escalonador encontrado\n","        ('rfe', RFE(estimator=base_regressor, \n","                    n_features_to_select= 20 ))  # Melhor número de features encontradas\n","    ])),\n","    ('model', KNeighborsRegressor(n_neighbors=5, \n","                                  weights='distance'))  # Melhor modelo e hiperparâmetros encontrados\n","])\n","\n","# Treinar o modelo final no conjunto de dados completo\n","final_pipeline.fit(X_train, y_train)\n","y_pred = final_pipeline.predict(X_test)\n","\n","r2 = final_pipeline.score(X_test, y_test)\n","\n","rmse = (mean_squared_error(y_test, y_pred)**0.5)\n","\n","mae = mean_absolute_error(y_test, y_pred)\n","\n","print('r2', r2)\n","print('rmse', rmse)\n","print('mae', mae)"]},{"cell_type":"code","execution_count":null,"id":"9a124ba7","metadata":{"papermill":{"duration":0.033511,"end_time":"2024-09-16T11:35:08.15722","exception":false,"start_time":"2024-09-16T11:35:08.123709","status":"completed"},"tags":[]},"outputs":[],"source":[]}],"metadata":{"kaggle":{"accelerator":"none","dataSources":[{"datasetId":5689421,"sourceId":9378917,"sourceType":"datasetVersion"}],"dockerImageVersionId":30761,"isGpuEnabled":false,"isInternetEnabled":true,"language":"python","sourceType":"notebook"},"kernelspec":{"display_name":"Python 3","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.10.14"},"papermill":{"default_parameters":{},"duration":745.825591,"end_time":"2024-09-16T11:35:10.814394","environment_variables":{},"exception":null,"input_path":"__notebook__.ipynb","output_path":"__notebook__.ipynb","parameters":{},"start_time":"2024-09-16T11:22:44.988803","version":"2.6.0"}},"nbformat":4,"nbformat_minor":5}